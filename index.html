<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Card Price Scanner</title>
    <meta name="description" content="ポケモンカードの価格差を瞬時に調べて利益を最大化するWebアプリ" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
</head>

<body>

    <!-- ===== ホーム画面 ===== -->
    <div id="screen-home" class="screen active">
        <div class="home-container">
            <div class="home-hero">
                <div class="hero-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0 0 20.25 18V6A2.25 2.25 0 0 0 18 3.75H6A2.25 2.25 0 0 0 3.75 6v12A2.25 2.25 0 0 0 6 20.25Z" />
                    </svg>
                </div>
                <h1 class="hero-title">Card Price Scanner</h1>
                <p class="hero-sub">価格差を見つけて利益を最大化</p>
            </div>

            <div class="home-buttons">
                <button id="btn-scan" class="btn-main btn-primary" onclick="showScreen('scan')">
                    <span class="btn-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
                        </svg>
                    </span>
                    <span class="btn-text">
                        <span class="btn-label">カードをスキャン</span>
                        <span class="btn-desc">カメラ・画像で瞬時に検索</span>
                    </span>
                    <svg class="btn-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                    </svg>
                </button>

                <button id="btn-search" class="btn-main btn-secondary" onclick="showScreen('search')">
                    <span class="btn-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                        </svg>
                    </span>
                    <span class="btn-text">
                        <span class="btn-label">名前で検索</span>
                        <span class="btn-desc">カード名を入力して検索</span>
                    </span>
                    <svg class="btn-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                    </svg>
                </button>

                <button id="btn-favorites" class="btn-main btn-secondary" onclick="showScreen('favorites')">
                    <span class="btn-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                        </svg>
                    </span>
                    <span class="btn-text">
                        <span class="btn-label">お気に入り</span>
                        <span class="btn-desc">保存したカードを確認</span>
                    </span>
                    <svg class="btn-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ===== スキャン画面 ===== -->
    <div id="screen-scan" class="screen">
        <header class="app-bar">
            <button class="back-btn" onclick="showScreen('home')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                </svg>
            </button>
            <h2 class="app-bar-title">カードスキャン</h2>
        </header>

        <div class="scan-container">
            <!-- アップロードエリア -->
            <div id="upload-area" class="upload-area" onclick="triggerFileInput()">
                <!-- capture属性はデスクトップでのファイル選択を妨げるため削除 -->
                <input type="file" id="file-input" accept="image/*" style="display:none"
                    onchange="handleFileSelect(event)" />
                <div class="upload-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
                    </svg>
                </div>
                <p class="upload-title">タップまたはクリックして画像を選択</p>
                <p class="upload-sub">JPG / PNG / WEBP に対応</p>
            </div>

            <!-- プレビュー -->
            <div id="preview-area" class="preview-area hidden">
                <img id="preview-img" src="" alt="カードプレビュー" class="preview-img" />
                <button class="btn-retake" onclick="resetScan()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
                    </svg>
                    再撮影
                </button>
            </div>

            <!-- 認識結果 -->
            <div id="result-card" class="result-card hidden">
                <div class="result-header">
                    <span id="result-status-icon" class="result-icon loading"></span>
                    <span id="result-status-text" class="result-title">認識中...</span>
                </div>
                <div id="result-loading" class="result-loading">
                    <div class="spinner"></div>
                    <p>Gemini AIが解析しています...</p>
                </div>
                <div id="result-content" class="result-content hidden"></div>
                <div id="result-error" class="result-error hidden"></div>
            </div>

            <!-- 5店舗検索ボタン -->
            <div id="shop-buttons-area" class="shop-buttons-area hidden"></div>


        </div>
    </div>

    <!-- ===== 検索画面 ===== -->
    <div id="screen-search" class="screen">
        <header class="app-bar">
            <button class="back-btn" onclick="showScreen('home')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                </svg>
            </button>
            <h2 class="app-bar-title">カード検索</h2>
            <button id="mock-toggle-btn" onclick="toggleMockMode()"
                style="margin-left: auto; padding: 4px 12px; border-radius: 8px; border: 1px solid #555; background: #333; color: #fff; font-size: 12px; cursor: pointer;">☁️
                OFF</button>
        </header>

        <div id="mock-banner" class="hidden"
            style="background: #ff9800; color: #000; text-align: center; padding: 4px 0; font-size: 12px; font-weight: bold;">
            🧪 デバッグモード: ダミーデータを使用中</div>

        <div class="search-container">
            <div class="search-bar-wrap">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
                <input type="text" id="search-input" class="search-input" placeholder="カード名を入力（例: ピカチュウ）"
                    oninput="handleSearchInput(event)" onkeydown="handleSearchInput(event)" />
                <button id="search-exec-btn" class="back-btn"
                    style="margin-right: 8px; border: 1px solid #333; border-radius: 8px; font-size: 14px"
                    onclick="performAISearch()">検索</button>
                <button id="clear-btn" class="clear-btn hidden" onclick="clearSearch()">✕</button>
            </div>

            <div id="card-list" class="card-list"></div>

            <div id="no-results" class="no-results hidden">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
                <p>該当するカードが見つかりません</p>
            </div>
        </div>
    </div>

    <!-- ===== カード詳細画面 ===== -->
    <div id="screen-detail" class="screen">
        <header class="app-bar">
            <button class="back-btn" onclick="showScreen('search')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                </svg>
            </button>
            <h2 class="app-bar-title">カード詳細</h2>
            <button id="detail-fav-btn"
                style="margin-left: auto; font-size: 20px; background: transparent; border: none; cursor: pointer; padding: 4px 8px;">🩶</button>
        </header>

        <div class="detail-container">
            <div class="detail-hero">
                <div class="detail-hero-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <rect x="3" y="3" width="18" height="18" rx="2" />
                        <circle cx="12" cy="10" r="3" />
                        <path stroke-linecap="round" d="M6.5 18c0-2.5 2.5-4 5.5-4s5.5 1.5 5.5 4" />
                    </svg>
                </div>
                <h3 id="detail-name" class="detail-name"></h3>
                <p id="detail-set" class="detail-set"></p>
            </div>

            <div class="price-card hidden">
                <!-- 古い静的UIは廃止しました -->
            </div>

            <!-- 画像スキャン時と同じように、JSで生成されるショップボタンと価格相場が入るコンテナ -->
            <div id="shop-buttons-area" class="shop-buttons-area hidden"></div>
        </div>
    </div>

    <!-- ===== お気に入り画面 ===== -->
    <div id="screen-favorites" class="screen">
        <header class="app-bar">
            <button class="back-btn" onclick="showScreen('home')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                </svg>
            </button>
            <h2 class="app-bar-title">お気に入り</h2>
        </header>

        <div class="search-container">
            <div id="favorites-list" class="card-list"></div>
            <div id="no-favorites" class="no-results">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                </svg>
                <p>お気に入りはまだありません</p>
                <p style="font-size: 12px; color: #888;">カード詳細画面の❤️ボタンで追加できます</p>
            </div>
        </div>
    </div>

    <!-- ===== 広告プレースホルダー（Google AdSense用） ===== -->
    <!-- ※本番ドメイン承認後、この内部をAdSenseのタグに差し替えてください -->
    <div class="ad-fixed-footer">
        <div class="ad-placeholder">
            [広告枠プレースホルダー]
        </div>
    </div>

    <script src="cards_db.js"></script>
    <script src="app.js?v=4"></script>
</body>

</html>